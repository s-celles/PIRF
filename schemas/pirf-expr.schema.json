{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://domain.org/schemas/v0.1/pirf-expr.schema.json",
  "title": "PIRF-Expr",
  "description": "A mathematical expression in PIRF-Expr format (S-expression-in-JSON). Conforms to EARS Specification RUBI-PIRF v0.1, §4.",

  "definitions": {

    "operator-name": {
      "type": "string",
      "pattern": "^[A-Z][a-zA-Z0-9$]*$",
      "description": "PascalCase operator name per PIRF-X-004"
    },

    "symbol": {
      "type": "string",
      "pattern": "^[a-zA-Z$][a-zA-Z0-9_$]*(\\.(([0-9]+)|(-[0-9]+))?)?(_(integer|rational|positive|negative|complex)?)?$",
      "description": "Plain symbol, wildcard (x_, a., m.3, n_integer), or fluid variable ($base$). Per PIRF-X-001, PIRF-W-001..W-006."
    },

    "wildcard-mandatory": {
      "type": "string",
      "pattern": "^[a-zA-Z][a-zA-Z0-9]*_(integer|rational|positive|negative|complex)?$",
      "description": "Mandatory wildcard: x_, m_, n_integer. Per PIRF-W-001, PIRF-W-003."
    },

    "wildcard-optional": {
      "type": "string",
      "pattern": "^[a-zA-Z][a-zA-Z0-9]*\\.-?[0-9]*$",
      "description": "Optional wildcard with default: a. (default 0), b. (default 1), m.3 (default 3). Per PIRF-W-002, PIRF-W-002a."
    },

    "wildcard-sequence": {
      "type": "string",
      "pattern": "^[a-zA-Z][a-zA-Z0-9]*_{2,3}$",
      "description": "Sequence wildcard: xs__ (BlankSequence, 1+), xs___ (BlankNullSequence, 0+). Per PIRF-W-006."
    },

    "function-expr": {
      "type": "array",
      "minItems": 2,
      "items": [
        { "$ref": "#/definitions/operator-name" }
      ],
      "additionalItems": {
        "$ref": "#/definitions/pirf-expr"
      },
      "description": "Function application: [\"Operator\", arg1, arg2, ...]. Per PIRF-X-001."
    },

    "pirf-expr": {
      "description": "A PIRF-Expr value: number, symbol/wildcard string, or function application array. Per PIRF-X-001, PIRF-X-002.",
      "oneOf": [
        {
          "type": "number",
          "description": "JSON number (integer or float). Per PIRF-X-001."
        },
        {
          "type": "string",
          "description": "Symbol, wildcard, or constant name. Per PIRF-X-001."
        },
        {
          "$ref": "#/definitions/function-expr"
        }
      ]
    },

    "core-arithmetic-operators": {
      "description": "PIRF-X-010: Add, Subtract, Multiply, Divide, Power, Negate, Sqrt, Abs, Factorial",
      "enum": ["Add", "Subtract", "Multiply", "Divide", "Power", "Negate", "Sqrt", "Abs", "Factorial"]
    },

    "trig-operators": {
      "description": "PIRF-X-011: Full set of 6 circular trig functions",
      "enum": ["Sin", "Cos", "Tan", "Cot", "Sec", "Csc"]
    },

    "hyperbolic-operators": {
      "description": "PIRF-X-012: Full set of 6 hyperbolic functions",
      "enum": ["Sinh", "Cosh", "Tanh", "Coth", "Sech", "Csch"]
    },

    "inverse-trig-operators": {
      "description": "PIRF-X-013: Full set of 6 inverse circular functions",
      "enum": ["Asin", "Acos", "Atan", "Acot", "Asec", "Acsc"]
    },

    "inverse-hyperbolic-operators": {
      "description": "PIRF-X-014: Full set of 6 inverse hyperbolic functions",
      "enum": ["Asinh", "Acosh", "Atanh", "Acoth", "Asech", "Acsch"]
    },

    "exp-log-operators": {
      "description": "PIRF-X-015: Exponential and logarithmic",
      "enum": ["Exp", "Log"]
    },

    "special-function-operators": {
      "description": "PIRF-X-016: Special functions (RUBI sections 8.1-8.10)",
      "enum": [
        "PolyLog", "ProductLog",
        "Erf", "Erfi", "Erfc",
        "Gamma", "LogGamma", "Beta",
        "Hypergeometric2F1", "HypergeometricPFQ",
        "EllipticF", "EllipticE", "EllipticPi", "EllipticK",
        "ExpIntegralE", "ExpIntegralEi", "LogIntegral",
        "SinIntegral", "CosIntegral", "SinhIntegral", "CoshIntegral",
        "FresnelS", "FresnelC",
        "Zeta", "AppellF1",
        "BesselJ", "BesselY", "BesselI", "BesselK"
      ]
    },

    "constant-symbols": {
      "description": "PIRF-X-017: Mathematical constants",
      "enum": ["Pi", "E", "I", "Infinity", "ComplexInfinity", "GoldenRatio", "EulerGamma"]
    },

    "integration-operators": {
      "description": "PIRF-X-018: Integration-specific operators",
      "enum": ["Int", "Dist", "Subst", "Simp", "ExpandIntegrand", "Unintegrable", "CannotIntegrate"]
    },

    "utility-function-operators": {
      "description": "PIRF-X-019: Utility function operators (§4.11.1-4.11.6) — algorithmic functions implemented by each Phrasebook",
      "enum": [
        "NormalizeIntegrand", "SimplifyIntegrand", "SimplifyAntiderivative",
        "NormalizeLeadTermSigns", "NormalizeSumFactors", "AbsorbMinusSign",
        "FixSimplify", "SmartSimplify", "TogetherSimplify", "ContentFactor",

        "Coefficient", "Exponent", "IntPart", "FracPart",
        "Together", "Apart", "Cancel", "Factor", "Expand",
        "Numerator", "Denominator", "SmartNumerator", "SmartDenominator", "Rt",

        "TrigReduce", "TrigExpand", "TrigToExp", "ExpToTrig",
        "SmartTrigExpand", "SmartTrigReduce", "TrigSimplifyAux",
        "ActivateTrig", "DeactivateTrig",

        "LeadTerm", "RemainingTerms", "LeadFactor", "RemainingFactors",
        "LeadBase", "LeadDegree", "MergeableFactorQ", "MergeFactor", "MergeFactors",

        "SubstFor", "SubstForFractionalPowerOfLinear",
        "SubstForFractionalPowerOfQuotientOfLinears",
        "SubstForInverseFunction", "SubstForExpn",

        "D", "Dif", "Map", "Simplify", "FullSimplify", "ReplaceAll", "Mods"
      ]
    },

    "structural-utility-operators": {
      "description": "PIRF-X-020: Structural and utility operators (§4.12)",
      "enum": [
        "List", "Piecewise", "Condition", "If", "With", "Module",
        "CompoundExpression", "Rule", "Set",
        "Floor", "Ceiling", "Round", "Mod", "Max", "Min",
        "Sign", "Conjugate", "Re", "Im",
        "Head", "Length", "Part", "Apply", "Scan",
        "Catch", "Throw", "Hold", "HoldForm"
      ]
    },

    "predicate-names": {
      "description": "All predicates from §7 (PIRF-C-001 through PIRF-C-023)",
      "enum": [
        "FreeQ", "IndependentQ",
        "IntegerQ", "PositiveIntegerQ", "NegativeIntegerQ", "FractionQ",
        "RationalQ", "ComplexNumberQ", "RealNumericQ", "SqrtNumberQ",
        "SqrtNumberSumQ", "FractionOrNegativeQ", "FractionalPowerOfSquareQ",
        "IGtQ", "ILtQ", "IGeQ", "ILeQ", "IntegersQ",
        "EqQ", "NeQ", "GtQ", "LtQ", "GeQ", "LeQ",
        "ZeroQ", "NonzeroQ", "PositiveQ", "NegativeQ", "OddQ", "EvenQ",
        "PolynomialQ", "LinearQ", "QuadraticQ", "BinomialQ", "TrinomialQ",
        "PowerQ", "SumQ", "ProductQ", "IntegerPowerQ", "FractionalPowerQ",
        "QuotientOfLinearsQ",
        "TrigQ", "HyperbolicQ", "InverseTrigQ", "InverseHyperbolicQ",
        "LogQ", "InverseFunctionQ", "ElementaryFunctionQ",
        "AlgebraicFunctionQ", "AlgebraicTrigFunctionQ",
        "RationalFunctionQ", "BinomialMatchQ",
        "CalculusQ", "CalculusFreeQ", "IntegralFreeQ",
        "TrigHyperbolicFreeQ", "FunctionOfTrigOfLinearQ",
        "FunctionOfQ", "FunctionOfExponentialQ", "FunctionOfExponentialTest",
        "PureFunctionOfSinQ", "PureFunctionOfCosQ",
        "PureFunctionOfTanQ", "PureFunctionOfCotQ",
        "FunctionOfSinQ", "FunctionOfCosQ", "FunctionOfTanQ",
        "FunctionOfSinhQ", "FunctionOfCoshQ", "FunctionOfTanhQ",
        "FunctionOfHyperbolicQ", "FunctionOfTrigQ",
        "FractionalPowerSubexpressionQ",
        "MergeableFactorQ",
        "And", "Or", "Not"
      ]
    }
  },

  "$ref": "#/definitions/pirf-expr"
}
