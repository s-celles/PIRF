{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://domain.org/schemas/v0.1/rule-file.schema.json",
  "title": "PIRF Rule File",
  "description": "A JSON file containing RUBI integration rules. Conforms to EARS Specification RUBI-PIRF v0.1, §5.",
  "type": "object",
  "required": ["$schema", "section", "title", "rules"],
  "additionalProperties": false,

  "properties": {

    "$schema": {
      "type": "string",
      "const": "rubi-integration-rules/v0.1",
      "description": "Schema version identifier. Per PIRF-F-004."
    },

    "section": {
      "type": "string",
      "pattern": "^[0-9]+(\\.[0-9]+)*$",
      "description": "Taxonomy section number (e.g. '1.1.1', '4.3', '8.6'). Per PIRF-F-003, PIRF-T-003.",
      "examples": ["1.1.1", "3.2", "4.1.1.1", "8.10"]
    },

    "title": {
      "type": "string",
      "minLength": 1,
      "description": "Human-readable title of this rule section. Per PIRF-F-003.",
      "examples": [
        "(a+b x)^m",
        "u (a+b log(c x^n))^p",
        "(a+b sin)^n",
        "Error functions"
      ]
    },

    "rules": {
      "type": "array",
      "description": "Ordered array of integration rules. Position within array defines priority (first match wins). Per PIRF-F-005, PIRF-F-009.",
      "items": {
        "$ref": "#/definitions/rule"
      }
    }
  },

  "definitions": {

    "pirf-expr": {
      "$ref": "pirf-expr.schema.json#/definitions/pirf-expr"
    },

    "rule": {
      "type": "object",
      "required": ["id", "pattern", "constraints", "result"],
      "additionalProperties": false,
      "description": "A single integration rule: pattern + constraints → result. Per PIRF-F-006, PIRF-F-007.",

      "properties": {

        "id": {
          "type": "integer",
          "minimum": 1,
          "description": "Unique positive integer identifier for traceability and step-by-step display. NOT a priority key — priority is determined by load order + position in array. Per PIRF-F-008, PIRF-F-009."
        },

        "pattern": {
          "$ref": "#/definitions/pirf-expr",
          "description": "PIRF-Expr with wildcards describing the integrand form to match. Per PIRF-F-006."
        },

        "constraints": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/pirf-expr"
          },
          "description": "Array of predicate expressions that must all be true (implicit AND) for the rule to apply. Empty array means unconditional. Per PIRF-F-006, PIRF-C-031."
        },

        "result": {
          "$ref": "#/definitions/pirf-expr",
          "description": "PIRF-Expr of the antiderivative or recursive integration call. May contain Int, Dist, Subst, Simp, utility functions. Per PIRF-F-006."
        },

        "description": {
          "type": "string",
          "description": "Human-readable description of the rule, e.g. '∫(a+b·x)^n dx, n∈ℤ⁺'. Per PIRF-F-007."
        },

        "section": {
          "type": "string",
          "pattern": "^[0-9]+(\\.[0-9]+)*$",
          "description": "Override section number if different from file-level section. Per PIRF-F-007."
        },

        "references": {
          "type": "object",
          "description": "Bibliographic references (G&R, CRC, A&S rule numbers). Per PIRF-F-007, PIRF-D-003.",
          "properties": {
            "GR": {
              "type": "string",
              "description": "Gradshteyn & Ryzhik 'Table of Integrals' rule number"
            },
            "CRC": {
              "type": "string",
              "description": "CRC Standard Mathematical Tables rule number"
            },
            "AS": {
              "type": "string",
              "description": "Abramowitz & Stegun 'Handbook of Mathematical Functions' rule number"
            }
          },
          "additionalProperties": {
            "type": "string"
          }
        },

        "comment": {
          "type": "string",
          "description": "Free-form comment. Per PIRF-F-007."
        },

        "derivation": {
          "type": "string",
          "description": "Integration technique or basis identity used to derive the rule. Per PIRF-F-007."
        }
      }
    }
  }
}
