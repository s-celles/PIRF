{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://domain.org/schemas/v0.1/test-file.schema.json",
  "title": "PIRF Test File",
  "description": "A JSON file containing integration test problems. Conforms to EARS Specification RUBI-PIRF v0.1, §12.",
  "type": "object",
  "required": ["$schema", "section", "title", "tests"],
  "additionalProperties": false,

  "properties": {

    "$schema": {
      "type": "string",
      "const": "rubi-integration-rules/v0.1",
      "description": "Schema version identifier."
    },

    "section": {
      "type": "string",
      "pattern": "^[0-9]+(\\.[0-9]+)*$",
      "description": "Taxonomy section number corresponding to the rules being tested.",
      "examples": ["1.1.1", "4.1", "8.6"]
    },

    "title": {
      "type": "string",
      "minLength": 1,
      "description": "Human-readable title of this test section."
    },

    "tests": {
      "type": "array",
      "description": "Array of integration test problems.",
      "items": {
        "$ref": "#/definitions/test-problem"
      }
    }
  },

  "definitions": {

    "pirf-expr": {
      "$ref": "pirf-expr.schema.json#/definitions/pirf-expr"
    },

    "test-problem": {
      "type": "object",
      "required": ["id", "integrand", "variable", "optimal_antiderivative", "num_steps"],
      "additionalProperties": false,
      "description": "A single integration test problem. Per PIRF-V-002.",

      "properties": {

        "id": {
          "type": "integer",
          "minimum": 1,
          "description": "Unique positive integer test identifier."
        },

        "integrand": {
          "$ref": "#/definitions/pirf-expr",
          "description": "The expression to integrate, in PIRF-Expr format."
        },

        "variable": {
          "type": "string",
          "pattern": "^[a-zA-Z][a-zA-Z0-9]*$",
          "description": "The integration variable (plain symbol, no wildcard suffix).",
          "examples": ["x", "t", "u"]
        },

        "optimal_antiderivative": {
          "$ref": "#/definitions/pirf-expr",
          "description": "The optimal (simplest known) antiderivative in PIRF-Expr format. Results are compared by symbolic equivalence, not syntactic equality. Per PIRF-V-003."
        },

        "num_steps": {
          "type": "integer",
          "description": "Expected number of rule application steps. Positive: steps needed. Zero: trivial. Negative: RUBI cannot integrate (absolute value may indicate complexity)."
        },

        "grade": {
          "type": "string",
          "enum": ["A", "B", "C", "F"],
          "description": "Expected grade on the RUBI scale: A (≤2× optimal size), B (>2× but correct), C (correct, sub-optimal), F (incorrect/timeout). Per PIRF-V-004."
        },

        "comment": {
          "type": "string",
          "description": "Free-form comment about this test problem."
        }
      }
    }
  }
}
